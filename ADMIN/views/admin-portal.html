<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - Document Request Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.tailwind = window.tailwind || {};
    tailwind.config = { theme: { extend: { colors: { usjrg: '#2f855a', usjrgold: '#e8a90c', usjrbg: '#fff7e6', usjrdark: '#14532d', usjrgray: '#E5E7EB', 'usjr-green': '#2f855a', 'usjr-deep': '#14532d', 'usjr-gold': '#e8a90c', 'usjr-gold-dark': '#c58f08', 'usjr-cream': '#fff7e6' } } } };
    </script>
    <!-- FIXED CSS PATHS -->
    <link rel="stylesheet" href="../styles/admin-portal.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Make admin portal use the same white card container as student portal */
        .portal-container {
            background: rgba(255,255,255,0.96);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.06);
            padding: 30px;
            max-width: 1100px;
            margin: 120px auto 40px;
        }
        .portal-header { margin-bottom: 1.25rem; }
    </style>
</head>
<body>
    <nav class="navbar bg-usjrg text-white">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-file-alt"></i>
                <span>DocTracker</span>
            </div>
                <div class="nav-menu">
                <div class="nav-buttons">
                    <span class="nav-link">Welcome, Admin User</span>
                    <a href="#" class="btn btn-outline" onclick="logout()">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="portal-container">
        <div class="portal-header">
            <div class="portal-icon"><i class="fas fa-users-cog"></i></div>
            <div>
                <h1>Admin Portal</h1>
                <p>Manage and process document requests</p>
            </div>
        </div>

        <div class="portal-grid">
            <div class="portal-main">
                <!-- Dashboard Stats -->
                <div class="dashboard-grid">
            <div class="stat-card">
                <h3 id="totalRequests">0</h3>
                <p>Total Requests</p>
            </div>
            <div class="stat-card">
                <h3 id="pendingRequests">0</h3>
                <p>Pending Review</p>
            </div>
            <div class="stat-card">
                <h3 id="processingRequests">0</h3>
                <p>In Processing</p>
            </div>
            <div class="stat-card">
                <h3 id="completedToday">0</h3>
                <p>Completed Today</p>
            </div>
            <aside>
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-user-shield"></i> Admin Menu</h3>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-column">
                            <a href="admin-portal.html" class="btn btn-outline" style="margin-bottom:8px; text-align:left;">Dashboard</a>
                            <button class="btn btn-outline" style="text-align:left;" onclick="logout()">Logout</button>
                        </div>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
            </div>
            <div class="card-body">
                <div class="d-flex gap-2">
                    <button class="btn btn-primary bg-green-700 hover:bg-green-800 text-white transition duration-150 ease-out transform hover:scale-105" onclick="showAllRequests()">
                        <i class="fas fa-list"></i> View All Requests
                    </button>
                    <button class="btn btn-secondary bg-yellow-500 hover:bg-yellow-600 text-black transition duration-150 ease-out transform hover:scale-105" onclick="showPendingRequests()">
                        <i class="fas fa-clock"></i> Pending Requests
                    </button>
                    <button class="btn btn-secondary bg-yellow-500 hover:bg-yellow-600 text-black transition duration-150 ease-out transform hover:scale-105" onclick="refreshData()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-filter"></i> Filter Requests</h3>
            </div>
            <div class="card-body">
                <div class="d-flex gap-2 mb-2">
                    <select id="statusFilter" class="form-control">
                        <option value="">All Status</option>
                        <option value="Submitted">Submitted</option>
                        <option value="Processing">Processing</option>
                        <option value="Ready for Release">Ready for Release</option>
                        <option value="Completed">Completed</option>
                        <option value="Declined">Declined</option>
                        <option value="Action Required">Action Required</option>
                    </select>
                    <select id="typeFilter" class="form-control">
                        <option value="">All Types</option>
                        <option value="TOR">TOR</option>
                        <option value="GoodMoral">Good Moral</option>
                        <option value="COE">COE</option>
                        <option value="COG">COG</option>
                        <option value="Other">Other</option>
                    </select>
                    <select id="dateFilter" class="form-control">
                        <option value="">All Dates</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                    <input type="text" id="searchFilter" class="form-control" placeholder="Search by student name or ID...">
                </div>
                <button class="btn btn-primary" onclick="applyFilters()">
                    <i class="fas fa-search"></i> Apply Filters
                </button>
            </div>
        </div>

        <!-- Requests Table -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-table"></i> Document Requests</h3>
            </div>
            <div class="card-body">
                <div id="requestsTable">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Request ID</th>
                                <th>Student</th>
                                <th>Document Type</th>
                                <th>Status</th>
                                <th>Date Submitted</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="requestsTableBody">
                            <!-- Requests will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Notifications -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-bell"></i> Recent Notifications</h3>
            </div>
            <div class="card-body">
                <div id="notificationsList">
                    <!-- Notifications will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Request Processing Modal -->
    <div id="processModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Process Request</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div id="processDetails">
                <!-- Process details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Add Notes Modal -->
    <div id="notesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Notes</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="notesForm">
                    <div class="form-group">
                        <label for="noteText">Note</label>
                        <textarea id="noteText" class="form-control" rows="4" placeholder="Enter your note here..."></textarea>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Note
                        </button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin entry modal: require role password when opening admin portal -->
    <div id="adminEntryModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-lock"></i> Admin Access Required</h3>
            </div>
            <div class="modal-body">
                <p>Please enter the admin role password to access this portal.</p>
                <div class="form-group">
                    <input type="password" id="adminEntryPassword" class="form-control" placeholder="Enter admin password">
                </div>
                <div id="adminEntryError" aria-live="polite" style="display:none; margin-top:0.5rem; color:#b71c1c; background:#ffebee; padding:0.5rem; border-radius:4px;"></div>
                <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-primary" id="adminEntrySubmit">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FIXED JAVASCRIPT PATHS -->
    <script src="../../shared/utils.js"></script>
    <script src="../scripts/admin-portal.js"></script>

    <script>
        // Require admin password when loading this page if not already verified in this session
        (function() {
            function openAdminEntry() {
                const modal = document.getElementById('adminEntryModal');
                if (!modal) return;
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                const pwd = document.getElementById('adminEntryPassword');
                if (pwd) pwd.focus();
            }

            function closeAdminEntry() {
                const modal = document.getElementById('adminEntryModal');
                if (!modal) return;
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }

            // Wait until auth-script defines ADMIN_PASSWORD (auth-script.js is included above)
            document.addEventListener('DOMContentLoaded', function() {
                try {
                    const verified = sessionStorage.getItem('roleVerified');
                    if (verified === 'admin') return; // already verified this session

                    // show modal and require password
                    openAdminEntry();

                    const submitBtn = document.getElementById('adminEntrySubmit');
                    const pwdInput = document.getElementById('adminEntryPassword');
                    const errEl = document.getElementById('adminEntryError');

                    submitBtn.addEventListener('click', function() {
                        const val = pwdInput.value || '';
                        // ADMIN_PASSWORD comes from auth-script.js; fallback to 'admin123' if not defined
                        const adminPwd = (typeof ADMIN_PASSWORD !== 'undefined') ? ADMIN_PASSWORD : 'admin123';
                        if (val === adminPwd) {
                            try { sessionStorage.setItem('roleVerified', 'admin'); } catch (e) {}
                            closeAdminEntry();
                        } else {
                            if (errEl) {
                                errEl.textContent = 'Incorrect role password. Only authorized personnel may access this area.';
                                errEl.style.display = 'block';
                                clearTimeout(errEl._hideTimeout);
                                errEl._hideTimeout = setTimeout(() => { errEl.style.display = 'none'; }, 5000);
                            } else {
                                alert('Incorrect password');
                            }
                            pwdInput.value = '';
                            pwdInput.focus();
                        }
                    });

                    // also submit on Enter
                    pwdInput.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter') { e.preventDefault(); submitBtn.click(); }
                    });
                } catch (e) {
                    console.error('Admin entry check failed', e);
                }
            });
        })();
    </script>
</body>
</html>